"use client"
import { sendCaptureStream } from "@/lib/llm/llmClient";
import { CaptureImage } from "@/lib/llm/types";
import React, { useEffect, useState } from "react";

const StreamPage = () => {
    // const [tempChat, setTempChat] = useState<string[]>([]);
    const [chat, setChat] = useState<string>("");

    // useEffect(() => {
    //   // setChat(tempChat.map(tc => JSON.parse(tc || "{}")?.choices[0]?.delta || "").join(""));
    // }, [tempChat])

    const image: CaptureImage = {mime: "image/jpeg", data: "iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAIAAADwf7zUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAJ30Y2FCWAAAnfRqdW1iAAAAHmp1bWRjMnBhABEAEIAAAKoAOJtxA2MycGEAAAA0qmp1bWIAAABHanVtZGMybWEAEQAQgAAAqgA4m3EDdXJuOnV1aWQ6NTllZjVmNmYtYzdiNy00NjkzLTk2M2ItYzMxZGQyZWJmYjJhAAAABXFqdW1iAAAAKWp1bWRjMmFzABEAEIAAAKoAOJtxA2MycGEuYXNzZXJ0aW9ucwAAAALPanVtYgAAAClqdW1kY2JvcgARABCAAACqADibcQNjMnBhLmhhc2guYm94ZXMAAAACnmNib3KiY2FsZ2ZzaGEyNTZlYm94ZXOMo2VuYW1lc4FjU09JZGhhc2hYIHFWOtgAYUB+3pxvMWg2KEvTcQpSDFp5K17aHLcDaQgVY3BhZECjZW5hbWVzgWRDMlBBZGhhc2hBAGNwYWRAo2VuYW1lc4FkQVBQMGRoYXNoWCClu6CS/+oZuLBX+mjJTawJ8BxrRX3m5mel3iXquVu0GmNwYWRAo2VuYW1lc4FjRFFUZGhhc2hYIBvb8Xk9J4RP2SqsmmMk8IF57XOFdRc0JV5NJ7mYIiCnY3BhZECjZW5hbWVzgWNEUVRkaGFzaFggIsSzSLnps+p2r+G6ZgfVFl/DhhVkdm7DQ0ZF9AF0uiVjcGFkQKNlbmFtZXOBZFNPRjBkaGFzaFggQ5kh84q2wzFCx5o1pyuctxNMHx1vJosDFvNFXn7F51VjcGFkQKNlbmFtZXOBY0RIVGRoYXNoWCCLfeBKYqk6DARqxLEPvUgdXvrYFdIcJlYlPsugBrbfcGNwYWRAo2VuYW1lc4FjREhUZGhhc2hYICppt2POOgTxT8zUKJFpJfiacKv9fr9qTr3VH2NHh+3jY3BhZECjZW5hbWVzgWNESFRkaGFzaFgg81d2DynUjW2SAHlwLsm0iA3HNBMm8S6n9ev2de/RoexjcGFkQKNlbmFtZXOBY0RIVGRoYXNoWCBif2h4O19QWbzOZN1Q4h0LnriggwUfEF1qgKdgzSpWTmNwYWRAo2VuYW1lc4FjU09TZGhhc2hYIGUJK8tZOntEQp6iKdcmRheoIeJ1YKyyj4QbWRKit/TSY3BhZECjZW5hbWVzgWNFT0lkaGFzaFggzeZueOVBnep033z0PZqodrjGadQAZ5kucZzvkKxfP+BjcGFkQAAAAQZqdW1iAAAALGp1bWRjYm9yABEAEIAAAKoAOJtxA2MycGEuaW5ncmVkaWVudC52MgAAAADSY2JvcqRoZGM6dGl0bGVzRW1iZWRkZWQgSW5ncmVkaWVudGlkYzpmb3JtYXRjYmlubHJlbGF0aW9uc2hpcGtjb21wb25lbnRPZm1jMnBhX21hbmlmZXN0o2N1cmx4PnNlbGYjanVtYmY9L2MycGEvdXJuOnV1aWQ6MGIwMzljOGMtYjkzMy00MzgxLTg1ZTYtZGEyZTFiMDYwNDdmZGhhc2hYIHaS6XIfzsOZFnydtvY/7lLTcU1wQYh01z57/8uF3NyBY2FsZ2ZTSEEyNTYAAAFranVtYgAAAClqdW1kY2JvcgARABCAAACqADibcQNjMnBhLmFjdGlvbnMudjIAAAABOmNib3KhZ2FjdGlvbnOComZhY3Rpb25rYzJwYS5wbGFjZWRrZGVzY3JpcHRpb254NEFkZGVkIHRleHQsIGltYWdlKHMpLCBvciBvdGhlciBjb250ZW50IHRvIHRoZSBkZXNpZ26jZmFjdGlvbnZjMnBhLmNvbG9yX2FkanVzdG1lbnRza2Rlc2NyaXB0aW9ueFJBZGp1c3RlZCBwcm9wZXJ0aWVzIGxpa2UgY29sb3IsIHRvbmUsIHNhdHVyYXRpb24sIGNvbnRyYXN0LCBzaGFkb3dzLCBvciBoaWdobGlnaHRzcWRpZ2l0YWxTb3VyY2VUeXBleD9odHRwOi8vY3YuaXB0Yy5vcmcvbmV3c2NvZGVzL2RpZ2l0YWxzb3VyY2V0eXBlL2FsZ29yaXRobWljTWVkaWEAAAMSanVtYgAAACRqdW1kYzJjbAARABCAAACqADibcQNjMnBhLmNsYWltAAAAAuZjYm9yp2NhbGdmc2hhMjU2aWRjOmZvcm1hdGppbWFnZS9qcGVnaXNpZ25hdHVyZXhMc2VsZiNqdW1iZj1jMnBhL3Vybjp1dWlkOjU5ZWY1ZjZmLWM3YjctNDY5My05NjNiLWMzMWRkMmViZmIyYS9jMnBhLnNpZ25hdHVyZWppbnN0YW5jZUlEeC11cm46dXVpZDo4YjEwMTkxOC0yY2E1LTQ5NzEtODA3Zi02OWFiMDgyODU4MjhvY2xhaW1fZ2VuZXJhdG9ydk1pY3Jvc29mdF9EZXNpZ25lci8xLjB0Y2xhaW1fZ2VuZXJhdG9yX2luZm+BoWRuYW1ldk1pY3Jvc29mdF9EZXNpZ25lci8xLjBqYXNzZXJ0aW9uc4OjY2FsZ2ZzaGEyNTZjdXJseF1zZWxmI2p1bWJmPWMycGEvdXJuOnV1aWQ6NTllZjVmNmYtYzdiNy00NjkzLTk2M2ItYzMxZGQyZWJmYjJhL2MycGEuYXNzZXJ0aW9ucy9jMnBhLmhhc2guYm94ZXNkaGFzaFggGTM310YtFwIVtm/g1eAXwuoq1D9EbtRD+YXD8+1+mfejY2FsZ2ZzaGEyNTZjdXJseGBzZWxmI2p1bWJmPWMycGEvdXJuOnV1aWQ6NTllZjVmNmYtYzdiNy00NjkzLTk2M2ItYzMxZGQyZWJmYjJhL2MycGEuYXNzZXJ0aW9ucy9jMnBhLmluZ3JlZGllbnQudjJkaGFzaFggA1SyOy1pWdzmhFDgk/vD1CPeQSCRF8iCpy6B6V9JHqGjY2FsZ2ZzaGEyNTZjdXJseF1zZWxmI2p1bWJmPWMycGEvdXJuOnV1aWQ6NTllZjVmNmYtYzdiNy00NjkzLTk2M2ItYzMxZGQyZWJmYjJhL2MycGEuYXNzZXJ0aW9ucy9jMnBhLmFjdGlvbnMudjJkaGFzaFggr0ObZno89JLopSCbrUaEj6yjtR39t1NAsRG5i5rnBPsAACvYanVtYgAAAChqdW1kYzJjcwARABCAAACqADibcQNjMnBhLnNpZ25hdHVyZQAAACuoY2JvctKERKEBOCSiZ3g1Y2hhaW6DWQYpMIIGJTCCBA2gAwIBAgITMwAAABrD3sJQo1goEAAAAAAAGjANBgkqhkiG9w0BAQwFADBWMQswCQYDVQQGEwJVUzEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9uMScwJQYDVQQDEx5NaWNyb3NvZnQgU0NEIENsYWltYW50cyBSU0EgQ0EwHhcNMjMwODAzMTgxNTM1WhcNMjQwMzMxMTgxNTM1WjB0MQswCQYDVQQGEwJVUzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHUmVkbW9uZDEeMBwGA1UEChMVTWlj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"};

    return (
        <div>
            <h1>Stream</h1>
            <div>{chat.split("content\":\"").splice(1).map(c => (
              <>{c.split("\"},\"index\"")[0]}</>
            ))}</div>
            <button onClick={() => sendCaptureStream(image, (text) => {
              setChat(text);
            })}>GET</button>
        </div>
    )
}

export default StreamPage;